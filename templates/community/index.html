{% extends './base.html' %}
{% block content %}

<div class="container-fluid content-posts">
    <div class="row">
    <div class="col-xs-12 col-md-8">
        <br>
        <h4 class="small-heading">Discussions
        <div class="hr"></div>
        </h4>
        <div class="toolbar-posts">
           <h6 class="float-right"><a href="{% url 'blog:blog-add' %}">Create New Blog</a> | <a href="{% url 'blog:post-add' %}">Submit New Post</a></h6>
            <p>Sort by:
            <select>
                <option>Time</option>
                <option>Points</option>
            </select>
            &nbsp;
            Filter by:
            <select>
                <option>Codeschool</option>
                <option>Cogitans</option>
            </select>
            </p>
        </div>
        <ul class="posts">
          {% for blog in blogs reversed %}
          <li class="row">
              <div class="col-xs-12 col-md-12">
                <div class="small-xs">
                  <h5>{{blog.title}}</h5>
                  <h6 class="blog-date">{{ blog.date }} by <a href="{% url 'log:dashboard' name=blog.author %}"">{{ blog.author }}</a></h6>

                  {% if blog.isblog %}
                  <p>{{ blog.content|truncatewords:100 |safe }}<a href="{% url 'blog:blog-detail' blog.slug %}">(more...)</a></p>
                  {% else %}
                   <p>{{ blog.content|truncatewords:100 }}<a href="{% url 'blog:post-detail' blog.slug %}">(more...)</a></p>
                  {% endif %}
                  {% if blog.image.url is not None %}
                  <div class="post-image" style="background: url('{{ blog.image.url }}');background-size: cover;background-position: center;">
                  </div>
                {% endif %}
              </div>
              <div class="col-xs-12 col-md-12 post-actions">
                    <form class="form-horizontal" action="{% url 'community:toggle-upvote'%}" method="post">
                        <input type="hidden" value="{{ blog.title }}" name="title">
                        <input type="hidden" value="{{ blog.state }}" name="state">
                            {% if blog.state == 1 %}
                                <button type="submit" class="post-actions-button small-p upvoted"><i class="fa fa-thumbs-up"></i> Upvoted({{ blog.upvotes }})</button> | 
                            {% endif %}
                            {% if blog.state == 0 %}
                                <button type="submit" class="post-actions-button small-p"><i class="fa fa-thumbs-up"></i> Upvote ({{ blog.upvotes }})</button> |
                            {% endif %}
                    </form>
                    <a href="{% url 'blog:post-detail' blog.slug %}" class="small-p">2 comments</a> 
                    {% if user.username == blog.author %}
                      | <form action="{% url 'blog:post-edit' blog.slug %}" method="get">
                        <button class="post-actions-button small-p">Edit</button>
                      </form> |
                      <form action="{% url 'blog:blog-delete' blog.slug %}" method="post" >
                        {% csrf_token %}
                        <button class="post-actions-button small-p">Delete</button>
                      </form>
                    {% endif %}
                  {% if blog.tags.all %}
                    | <span class="small-p">Tags:</span>
                    {% for tag in blog.tags.all %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                  {% endif %}
                  {% comment %} <a href="#" class="small-p"></a> | {% endcomment %}
                 
              </div>
          </li>
          <hr>




          {% endfor %}

        </ul>
        <div class="toolbar-posts-bottom">
            <button class="btn-wire-dark">Previous</button>
            <button class="btn-wire-dark">Next</button>
            <br>
        </div>
    </div>

   <div class="col-xs-12 col-md-4 right-aside">
        <div class="sticky">
            <div class="col-xs-12">
                <br>
                <h4 class="small-heading">Latest
                        <div class="hr"></div>
                </h4>
                <ul>
                    {% if latest_posts %}
                    {% for latest in latest_posts reversed %}
                    <li>
                        <h5>{{latest.title}}</h5>
                        <h6 class="blog-date">{{latest.date}}</h6>
                        <p>{{latest.content|truncatewords:150}} <a href="{% url 'latest:latest_posts_detail' latest.slug %}">more...</a></p>
                    </li>
                    {% endfor %}
                    {% else %}
                    <h3>No upcoming posts.</h3>
                    {% endif %}
                    <div class="text-right"><a href="{% url 'latest:latest_posts' %}" class="btn-wire-dark">See all Posts</a></div>
                </ul>
            </div>
            <div class="col-xs-12">
                <br>
                    <h4 class="small-heading">Upcoming Events
                        <div class="hr"></div>
                    </h4>
                    <ul class="list-group">
                      {% if events %}
                      {% for event in events reversed %}
                      <li class="list-group-item">
                          <h5>{{event.title}}</h5>
                          <h6 class="blog-date">{{event.date}}</h6>
                          <p>{{event.content|truncatewords:50}} <a href="{% url 'event:detail' event.slug %}">more...</a></p>
                      </li>
                      {% endfor %}
                      {% else %}
                      <h3>No upcoming events.</h3>
                      {% endif %}
                    <a href="{% url 'event:events' %}" class="list-group-item"><div class="text-center">See all events</div></a>
                  </ul>
            </div>
        </div>
    </div>
    </div>
</div>
{% endblock %}
